% ========== Object reconstruction section ==========

A reconstruction procedure is applied in order to
deduce what particles gave rise to the observed signals,
%match signals in the detector to the corresponding physics object that created them,
and to measure the
kinematic properties of the incident particles.
The procedure used is different for any class of physics object. This section
discusses the details of the reconstruction for each of the objects used in the
two presented analyses: photons, electrons, muons, and jets.

Each of these physics objects are built from more intermediate `detector
objects', which are groups of signals in the relevant sub-detectors. These are
clusters in the calorimeters, and hits and tracks in the
\ac{ID} and \ac{MS}. These detector objects are defined in Section
\ref{sec:detector-atlas}.

\subsection{Photons}
\label{sec:methods-reconsruction-photon}

% Signature
Photon reconstruction covers two scenarios: unconverted photons where the photon
passes through the tracker and deposits its energy in the calorimeter, or
converted photons where the photon converts into an $e^+e^-$ pair inside the
tracker.
The signature for an unconverted photon is an \ac{EM} cluster with $E_T > 1.5$
GeV and no associated
track (due to the photon being electrically neutral). The signature for a
converted photon is two opposite-sign electron candidates with tracks from the
same vertex, within the tracking system, consistent with a massless particle.
These signatures are considered as photon candidates.

% Energy calculation and calibration
Transverse energies are calculated by combining candidate photon \ac{EM}
clusters with any further clusters within a $0.075\times0.125$
($\eta\times\phi$) area centred on the candidate cluster. Energy measurements
are corrected for scale and resolution effects due to variation in detector
response across $\eta$-$\phi$ and data-\ac{MC} differences. This calibration to
the raw calorimeter response is
calculated for both electrons and photons using $Z\to ee$ events
\cite{EGamCalibration2019}. Energy corrections to photons are validated using
photons from radiative Z boson decays, systematic uncertainties are included in
the results
(as discussed in Section \ref{sec:methods-systematics}) to account for
uncertainties from these corrections.

% Identification
Jets can produce similar signatures to photons, and so additional
requirements are placed on the calorimeter shower shape to discriminate against
these `fake photons'. The desired prompt photons typically result in more
collimated clusters contained within the \ac{EM} calorimeter, whereas fake
photons produce broader showers and leakage into the hadronic calorimeter.
An identification selection, consisting of a set of cuts on shower-shape
variables, is derived to minimise photon fakes. Signal photons for these analyses are
required to meet the identification criteria for the `tight' working point
defined in reference \cite{ATLASegamPerf2019}, whilst the `loose' identification
working point is applied as a pre-selection to all photons (this is relevant for
the ABCD method discussed in Section \ref{sec:methods-backgrounds-fakephoton}).
Table \ref{tab:methods-reconstruction-photonIDvars} gives definitions for the
shower-shape variables used to form these two working points.

%table
\begin{table}[tbp]
  \centering
  \renewcommand\arraystretch{1.3}
  \caption{
    Shower-shape variables used for identification of photons. The four
    variables contributing to the loose working point are shown, and all
    variables are used to define the tight working point. The full definition of
    the working points in relation to these variables is given in Reference
    \cite{ATLASegamPerf2019}.
  }
  \begin{tabular}{c|p{8cm}|c}
    \hline\hline
    Variable & Description & Working points\\
    \hline
    $R_\text{had}$     &    
    Ratio of $E_T$ in the hadronic calorimeter to that of the \acs{EM} cluster.
    & Loose, Tight \\
    $R_{\text{had}_1}$ &
    Ratio of $E_T$ in the first layer of the hadronic calorimeter to that
    of the \acs{EM} cluster.
    & Loose, Tight \\
    $R_\eta$           &
    Ratio of energies in a $3\times7$ area of calorimeter cells to that in a
    $7\times7$ area (in $\eta\times\phi$).
    & Loose, Tight \\
    $w_{\eta_2}$       &
    Lateral shower width in Layer 2 of the \ac{EM} calorimeter.
    & Loose, Tight \\
    %tight only:
    $E_\text{ratio}$   &
    Ratio of the difference between to the sum of the highest- and
    second-highest-energy energy cells in the cluster.
    & Tight \\
    $R_\phi$           &
    Ratio of energies in a $3\times3$ area of calorimeter cells to that in a
    $3\times7$ area (in $\eta\times\phi$).
    & Tight \\
    $w_{s,\text{tot}}$ &
    Total lateral shower width in Layer 1 of the calorimeter
    & Tight \\
    $w_{s,3}$          &
    Lateral shower width in a window of three cells around the highest-energy cell
    & Tight \\
    $f_\text{side}$    &
    Fraction of energy outside central three strips within seven strips of the
    maximum
    & Tight \\
    $\Delta E_s$       &
    Difference between energies of the second-highest-energy cell and the lowest
    energy cell in the region between the second-highest-energy cell and the
    highest-energy cell.
    & Tight \\
    $f_1$              &
    Ratio of the energy Layer 1 of the \ac{EM} calorimeter to the energy of the
    \ac{EM} cluster.
    & Tight \\
    \hline\hline
  \end{tabular}
  \label{tab:methods-reconstruction-photonIDvars}
\end{table}

Figure \ref{fig:methods-reconstruction-photonIDeff} shows the efficiency for
photon identification in Run 2, which for high-$E_T$ ($\gtrsim 40$ GeV)
loosely-isolated photons is greater than 90\%.

% Isolation
\newcommand\ptcone{$p_T^{\text{cone},20}$\xspace}
\newcommand\etcone{$E_T^{\text{cone},20}$\xspace}
Photons are also required to be isolated, to reduce backgrounds such
as photons produced in jets and as part of hadronic or \ac{EM} showers. These non-prompt photons
will typically appear nearby other activity in the detector. Prompt photons can be
selected by ensuring that photon candidates are isolated in a region with little
activity around them. Two variables are used to define the isolation:
\ptcone and \etcone.
Here \ptcone is the sum of transverse momenta of all $p_T > 1$ GeV tracks originating from the
\ac{PV} (the vertex of the hard scatter event), within a cone of $\Delta R < 0.2$ around the direction of the photon.
The \etcone variable is the sum of \ac{EM} cluster transverse energies within the same cone,
minus the energy of the photon.
Cuts are defined on these variables as a function of the photon $p_T$:
\ptcone $<0.05\cdot p_T^\gamma$ (track isolation) and \etcone $<0.065\cdot
p_T^\gamma$ (calorimeter isolation). This corresponds to the `FixedCutLoose'
criteria defined in Reference \cite{ATLASegamPerf2019}.

\begin{figure}[tbh]
  \centering
  \includegraphics[width=.8\textwidth]{\resource{photonID.pdf}}
  \caption{
    Efficiencies for identification of photons in Run 2 of the \acs{ATLAS}
    detector, as a function of transverse energy.
    Shown are the values for loosely-isolated unconverted photons in
    the central region of the detector. The efficiency is evaluated from data
    using three techniques, as indicated.
    \cite{ATLASphotonID2021}
  }
  \label{fig:methods-reconstruction-photonIDeff}
\end{figure}

Systematic uncertainties are included in the measurements to account for
uncertainties in the efficiencies of photon identification and isolation
\cite{PhotonIDIsoEff2016}.


\subsection{Electrons}

% Signature and energy
The basic signature to seed an electron is an \ac{EM} cluster with $E_T>1$ GeV
with an associated track that has hits in at least four silicon layers. As with
photons, the transverse energy for an electron candidate is calculated by
summing the energy of the seed cluster with any additional clusters in a
$0.075\times0.125$ ($\eta\times\phi$) area, as well as any clusters matched to
the same track as the seed.

Energy scale and resolution effects are accounted
for in the same manner as for photons, primarily using Z$\to ee$ decays for
energy calibrations, and then validated with electrons from $J/\psi\to ee$
events \cite{EGamCalibration2019}. Inefficiencies in this calibration are accounted for in systematic uncertainties.

%Identification and Isolation
Electron candidates are also subject to identification and isolation
requirements, to minimise the impact of fakes. Identification is based on both
\ac{EM} shower shape in the calorimeter and transition radiation in the
\ac{TRT}. Similarly to the photon, isolation is determined in both the tracker
and calorimeter by requiring that summed energies or momenta within a cone
around the seed are below a threshold. 

Electrons used for these analyses are required to match the `medium'
identification working point and the `FCLoose' isolation selection, both of
which are defined in Reference \cite{ATLASegamPerf2019}. The efficiency of
electron identification working points in Run-2 data is shown in Figure
\ref{fig:methods-reconstruction-electronIDeff}.

\begin{figure}[tbh]
  \centering
  \includegraphics[width=.8\textwidth]{\resource{electronID.pdf}}
  \caption{
    Efficiencies for identification of electrons in Run 2 of the \acs{ATLAS}
    detector, as a function of transverse energy. 
    Loose, medium, and tight working points for electron identification are
    shown in different colours. \cite{ATLASegamEffs2023}
  }
  \label{fig:methods-reconstruction-electronIDeff}
\end{figure}

\subsection{Muons}

% Basic signature
Muon candidates are seeded from tracks in either the \ac{MS} or \ac{ID}.  A seed
track in the \ac{MS} must be matched to a track in the \ac{ID}, and a seed track
in the \ac{ID} must be matched to at least three hits in the \ac{MS}.
% More complex requirements
Muon candidates are only considered here within the acceptance of the \ac{ID}
($|\eta| < 2.5$). Candidates must produce three hits in at least two \ac{MS}
stations, or in only one station for muons with $|\eta|<0.1$.
% Energy
The transverse momentum of the muon is calculated from a combined track fit of the
tracks/hits in the \ac{ID} and \ac{MS} and the corresponding energy loss in the
calorimeters.
This corresponds to the `medium' identification working point defined in
Reference \cite{MuonReco2021}.

% Isolation
Muons must also be isolated to preferentially select prompt muons from, e.g., boson decays
rather than those from hadronic sources. Muon isolation is given by the total
$p_T$ in a cone around the muon divided by the muon $p_T$. As with electrons and
photons, this is calculated in both the \ac{ID} and the calorimeter.

Efficiencies for reconstructing and identifying muons with this procedure exceed
98\% for tracks satisfying $0.1 < |\eta| < 2.5$ \cite{MuonReco2021}. Figure
\ref{fig:methods-reconstruction-muonEff} shows the efficiency as a function of
muon transverse momentum.

\begin{figure}[tbh]
  \centering
  \includegraphics[width=.9\textwidth]{\resource{muonID.pdf}}
  \caption{
    Efficiencies for reconstructing and identifying muons in Run 2 of the \acs{ATLAS}
    detector, as a function of transverse momentum. 
    Loose, medium, and tight working points for muon identification are
    shown in different colours. \cite{MuonReco2021}.
  }
  \label{fig:methods-reconstruction-muonEff}
\end{figure}


Data-MC comparisons are used to measure the efficiency and
resolution of muon reconstruction, accounted for in systematic uncertainties
\cite{MuonReco2021}.


\subsection{Jets}
\label{sec:methods-reconstruction-jet}

% What is a jet? How does it represent a quark/gluon?
A jet is a physics object representing a localised grouping of hadrons, rather
than a single particle. These localised groupings of hadrons can be formed by quarks or
gluons radiated from the hard scatter, since the initially quasi-free partons
will hadronise before interacting with any elements of the detector. Jets are
thus used as a reconstruction-level analogue of a quark or gluon produced in a
hard-scatter interaction.

% Jet algorithms
Reconstructing a jet requires use of a jet clustering algorithm in order to
combine clusters and tracks in the detector to collect all the particles likely
to have been produced by the incident hadron. Jet reconstruction in \ac{ATLAS}
uses the anti-$k_t$ jet clustering algorithm \cite{antikt}, with a distance
parameter of $R=0.4$. This algorithm is chosen for its infrared and collinear
safety; in short, the same set of jets would be constructed from an event if
additional soft emissions or collinear splittings are added \cite{Salam2010}. It
also produces geometrically-regular and approximately conical jets which are
convenient to work with experimentally.

% Jet collections
The definition of a jet is dependent on the clustering algorithm used and on the
information given as input to this algorithm.
A `jet collection' is the name
used for jets produced from a certain set of inputs. The baseline jet collection
used in the two presented analyses is `particle-flow' jets, in the \ac{VBS}
analysis `topo-cluster' jets are also considered. These are both defined through
the anti-$k_t$ algorithm, but the set of objects on which the algorithm acts is
different.

% Topo jets
Topo-cluster jets are formed using only calorimeter information, passing
topo-clusters as input to the clustering algorithm. Topo clusters, or
topological clusters, are a pileup-resistant formulation of a calorimeter
cluster: with cells added to a cluster based on whether the measured energy
exceeds a threshold determined by the expected noise in that cell. Since only
calorimeter information is used to create the jets, topo-cluster jets rely
heavily on the granularity and performance of the calorimeter \cite{Aad2017b}.

%PFlow jets
Particle-flow jets are an alternative jet collection created by using
`particle-flow objects' as input to the clustering algorithm. A particle-flow
object is a combination of calorimeter topo-clusters and \ac{ID} tracks, with
calorimeter deposits produced by charged particles removed to avoid
energy/momentum double-counting, designed to represent a single particle.
Combining calorimeter and tracker information allows for improved resolution at
lower energies compared to topo-cluster jets \cite{Aaboud2017a}.

% Uncertainties
Systematic uncertainties are included to account for effects on the energy scale
and resolution of jets from detector calibration, properties of the jet such as
quark/gluon flavour composition, and data-\ac{MC} differences
\cite{JESUncerts2017}.

% Flavour tagging
It can be useful for physics analyses to establish whether a jet was likely
initiated by a b-quark; this process, known as `flavour tagging' or `b-tagging', is used in the
\ac{VBS} \Zy analysis to reject against backgrounds which are likely to produce
b-quarks in the final state. Flavour tagging is performed by dedicated
algorithms which use tracking information to identify differences in the
properties of tracks and reconstruct displaced vertices (e.g. where
a b-quark has travelled a short distance in the detector before decaying to
lighter quark flavours) within a jet \cite{ATLASbtag2019}.

\subsection{Overlap removal}

\begin{sloppypar}
Overlap removal (\acsfirst{OR}) avoids double-counting of energies across
multiple objects. Jet
\ac{OR} avoids fake jets that are reconstructed from a prompt electron or photon
signal and also avoids cases where near-coincident leptons and jets might bias
each other's reconstruction. Muon-electron \ac{OR} avoids reconstructing
electrons from muon bremsstrahlung, meanwhile photon-lepton \ac{OR} acts as an
additional isolation precaution \cite{Adams2015}.
\end{sloppypar}

Once the above objects are reconstructed, they are only used in the analyses if
they survive \ac{OR}. This procedure takes the lists of each set of
object and removes candidates based on their proximity to other objects.
%
First, jet candidates are removed if $\Delta R(j,e) < 0.2$ or $\Delta
R(j,\gamma) < 0.4$ for any $e$ or $\gamma$. Lepton candidates are subsequently
removed if $\Delta R(l,j) < 0.4$ for any remaining jet. Photon candidates are
removed if $\Delta R(\gamma,l) < 0.4$ and electrons removed if $\Delta R(\mu,e)
< 0.2$.

