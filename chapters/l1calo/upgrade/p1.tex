%%% Phase-I upgrade subsection %%%

The Phase-I upgrade has progressed alongside the work discussed in this chapter,
to the point where the system is fully implemented and in use in Run 3 at the
time of writing. The goal of the Phase-I upgrade to \ac{L1Calo} is
a redesign of the core components of the trigger in order to handle more data
and make more refined decisions while rejecting events.

% Introduce components in Phase I
The main components introduced in the Phase-I upgrade are the \ac{FEX} systems,
which replace the \ac{CP} and \ac{JEP} from the Run-2 system. The \ac{eFEX}
provides discrimination for \egamma and $\tau$ objects, the \ac{jFEX} focuses
on jets whilst providing additional $\tau$ identification, and the \ac{gFEX}
triggers on large-radius jets and global quantities such as missing energy.

\begin{figure}
  \centering
  \includegraphics[width=.95\textwidth]{\resource{p1-diagram.pdf}}
  \caption{
    Diagram showing the \acs{L1Calo} modules in use for Run 3 of the \acs{LHC}.
    Gold rectangles represent modules introduced in the Phase-I upgrade. 
    Blue and green rectangles represent existing components from the Run 2
    system, included still as part of the trigger whilst transitioning to the
    new system. \cite{Brawn2019}
  }
  \label{fig:trig-upgrade-p1-diagram}
\end{figure}

% Discuss diagram and changes from Run 2 to Phase I
An overview of the Phase-I system architecture is shown in Figure
\ref{fig:trig-upgrade-p1-diagram}. The key change to the \egamma signature
trigger is that it now receives digital information from the \ac{LAr}
Calorimeter in the form of SuperCells, rather than the analogue tower energies
that were available to the Run-2 system. This information is processed by the
\ac{eFEX} to generate \acp{TOB}, equivalent to the \acp{RoI} generated by the
\ac{CP} in Run 2.

% Explain SuperCells and their size
The move to digital input comes with an increase in granularity, a trigger tower
now being split in both $\eta$ and calorimeter layer to give up to 10
SuperCells: typically one SuperCell each from Layers 0 (presampler) and 3 and
four SuperCells each from Layers 1 and 2, segmented in $\eta$. Each SuperCell is
formed by summing energies from between four and eight calorimeter cells. This
division of a tower into SuperCells is shown in Figure
\ref{fig:trig-upgrade-supercells}. The granularity received from the Tile
Calorimeter is the same as in Run 2, the energy in a tower (this is later
referred to as Layer 4).

\begin{figure}
  \centering
  \includegraphics[width=.95\textwidth]{\resource{supercells.pdf}}
  \caption{
    Diagram showing division of a single trigger tower into SuperCells.
    \cite{ATLAS-TDR-TDAQ-PhaseI}
  }
  \label{fig:trig-upgrade-supercells}
\end{figure}

% Introduce algorithms
The \ac{eFEX} introduces new algorithms to use the SuperCell information in
order to trigger on \egamma objects. In comparison to the \ac{CP} in Run 2 which
calculates a cluster energy and a single isolation value, the \ac{eFEX}
calculates three separate variables used to identify and isolate a candidate
object and can also more accurately calculate the energy from SuperCell
information.

To calculate any of these variables a seed SuperCell is first identified, as the
highest energy SuperCell in Layer 2 of the calorimeter compared to the
surrounding region. The energy of the cluster is calculated by summing the
energy of the seed with its highest energy neighbour in $\phi$ and both
neighbours in $\eta$, adding also the six corresponding SuperCells in Layer 1,
and the two SuperCells from Layers 0 and 3 that are in the same tower as the
seed. The three other discriminating variables are calculated as follows:
%
\begin{equation*}
  R_\eta = \frac{\text{energy~in~}3\times2~\text{area~of~cells}}
                {\text{energy~in~}7\times3~\text{area~of~cells}},
\end{equation*}
%
with each area (in $\eta\times\phi$) centred on the seed and calculated in Layer
2;
%
\begin{equation*}
  R_\text{had} = \frac{\text{core~energy}}
                 {\text{environment~energy}},
\end{equation*}
%
where the core energy is calculated in the same manner as for the cluster energy
but including both neighbours in $\phi$ (so a $3\times3$ area of SuperCells in
Layers 1 and 2 and a $1\times3$ area in Layers 0 and 3) and the environment
energy is the energy in a $3\times3$ tower area in Layer 4 (i.e. the hadronic
calorimeter); and
%
\begin{equation*}
  w_{s,tot}^2 = \frac{\sum_i i^2 \cdot E_i}
                     {\sum_i E_i },
\end{equation*}
%
where $i\in[-2,2]$ is the $\eta$ coordinate of the SuperCell relative to the
seed, calculated for SuperCells in Layer 1 with both neighbours in $\phi$ also
summed for each $E_i$. Visual representations of the areas included for these
algorithms are presented alongside the work done in Section \ref{sec:trig-vis}.

Candidate $\tau$ particles considered by the \ac{eFEX} have a similar set of
variables (cluster energy, $R_\eta$, and $R_\text{had}$) with small differences
in the areas used in their calculation.

% What's left to say? Perhaps nothing!
